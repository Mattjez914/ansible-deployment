---

- hosts: all
  become: true
  tasks:

  - name: install nginx package
    tags: nginx,ubuntu
    apt:
      name: nginx
      state: present
      update_cache: yes
    when: ansible_distribution in ["Debian","Ubuntu"]

  - name: start and enable nginx
    tags: nginx,ubuntu
    service:
      name: nginx
      state: started
      enabled: yes
    when: ansible_distribution in ["Debian","Ubuntu"]

  - name: disable nginx default website
    tags: nginx,ubuntu
    file:
      path: /etc/nginx/sites-enabled/default
      state: absent
    when: ansible_distribution in ["Debian","Ubuntu"]

  - name: deploy web config file
    tags: nginx,ubuntu
    template:
      src: templates/nginxSetup
      dest: /etc/nginx/sites-available/test
    when: ansible_distribution in ["Debian","Ubuntu"]

  - name: enable website
    tags: nginx,ubuntu
    file:
      src: /etc/nginx/sites-available/test
      dest: /etc/nginx/sites-enabled/test
      state: link
    when: ansible_distribution in ["Debian","Ubuntu"]
    notify:
     - Restart nginx
    when: ansible_distribution in ["Debian","Ubuntu"]

# - handlers:
#   - name: restart nginx
#     service:
#       name: nginx
#       state: restarted
